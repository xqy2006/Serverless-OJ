import{_ as X,e as g,B as K,f as Z,l as ee,c as A,a,w as u,r as c,o as y,d as S,g as D,b,i as x,F as M,C as te,u as ae,D as z,E as _,p as le,t as oe,y as ne,G as ue}from"./index-L1DJ2Smp.js";import{e as L}from"./toggleHighContrast-DKTIqVgh.js";import{a as R}from"./axios-DXsv3KKR.js";const se={class:"contribute-container"},re={class:"test-cases"},ie={class:"test-case-header"},de="https://api.github.com",ce="xqy2006",pe="Serverless-OJ",me={__name:"Contribute",setup(fe){const F=ae(),k=g(null),B=g(null),U=g(!1),P=g(0);g([]);const e=g({title:"",memoryLimit:256,timeLimit:1e3,difficulty:"easy",submitType:1,useSpecialJudge:!1,specialJudgeCode:`#include <stdio.h>
#include <stdlib.h>

int main(int argc, char* argv[]) {
    if (argc != 4) {
        fprintf(stderr, "Usage: spj <input_file> <output_file> <answer_file>\\n");
        return 2;  // 特判程序错误
    }

    FILE *fin = fopen(argv[1], "r");  // 输入文件
    FILE *fout = fopen(argv[2], "r"); // 选手输出
    FILE *fans = fopen(argv[3], "r"); // 标准答案

    if (!fin || !fout || !fans) {
        fprintf(stderr, "Failed to open files\\n");
        return 2;  // 特判程序错误
    }

    fclose(fin);
    fclose(fout);
    fclose(fans);

    return 0;  // 0: AC, 1: WA
}`,language:"cpp",sourceCode:"",readme:"",testCases:[{input:"",output:""}]}),C={fontSize:14,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,language:"markdown",theme:"vs-light",wordWrap:"off",lineNumbers:"on",padding:{top:8,bottom:8}},N=g(null);let p=null,d=null,f=null;K(()=>e.value.useSpecialJudge,l=>{l&&z(()=>{p&&p.dispose(),p=L.create(N.value,{...C,language:"cpp",value:e.value.specialJudgeCode}),p.onDidChangeModelContent(()=>{e.value.specialJudgeCode=p.getValue()}),p.layout()})}),K(()=>e.value.submitType,l=>{l===1&&z(()=>{d&&d.dispose(),d=L.create(k.value,{...C,language:"cpp",value:e.value.sourceCode}),d.onDidChangeModelContent(()=>{e.value.sourceCode=d.getValue()}),d.layout()})});const q=()=>{e.value.testCases.push({input:"",output:""})},$=l=>{e.value.testCases.length>1&&e.value.testCases.splice(l,1)};async function G(l){const s=await(await fetch("/public_key.pem")).text(),o=await crypto.subtle.importKey("spki",j(s),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=await crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt"]),i=crypto.getRandomValues(new Uint8Array(16)),h=await crypto.subtle.exportKey("raw",r),v=await crypto.subtle.encrypt({name:"RSA-OAEP"},o,h),T=new TextEncoder().encode(l),w=await crypto.subtle.encrypt({name:"AES-CBC",iv:i},r,T),m=new Uint8Array(v.byteLength+i.byteLength+w.byteLength);m.set(new Uint8Array(v),0),m.set(i,v.byteLength),m.set(new Uint8Array(w),v.byteLength+i.byteLength);let E="";for(let n=0;n<m.length;n++)E+=String.fromCharCode(m[n]);return btoa(E)}function j(l){const t=l.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),s=atob(t),o=new Uint8Array(s.length);for(let r=0;r<s.length;r++)o[r]=s.charCodeAt(r);return o.buffer}async function H(l,t){const s=localStorage.getItem("github_token");if(!s)throw new Error("No GitHub token found");return(await R.post("https://api.github.com/gists",{description:l,public:!0,files:{"problem-description.md":{content:t}}},{headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json"}})).data}async function W(l,t){const s=localStorage.getItem("github_token");if(!s)throw new Error("No GitHub token found");return(await R.post(`${de}/repos/${ce}/${pe}/issues`,{title:l,body:t},{headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json"}})).data}const Y=async()=>{if(!e.value.title.trim()||!e.value.readme.trim()){_.error("题目标题和描述不能为空");return}if(e.value.testCases.some(l=>!l.input.trim())){_.error("所有测试样例的输入不能为空");return}if(e.value.submitType===1&&!e.value.sourceCode.trim()){_.error("源代码不能为空");return}if(e.value.submitType===2&&e.value.testCases.some(l=>!l.output.trim())){_.error("所有测试样例的输出不能为空");return}U.value=!0;try{const l={id:P.value+1,title:e.value.title,memoryLimit:e.value.memoryLimit,timeLimit:e.value.timeLimit,difficulty:e.value.difficulty,author:le().login,specialJudge:{enabled:e.value.useSpecialJudge,language:"cpp"}};let t=JSON.stringify(l)+`
---SEPARATOR---
`;t+=e.value.readme+`
---SEPARATOR---
`,e.value.submitType===1?(t+=`---SOURCE---
`,t+=e.value.sourceCode+`
---INPUTS---
`,e.value.testCases.forEach((r,i)=>{t+=r.input+`
`,i<e.value.testCases.length-1&&(t+=`---CASE---
`)})):e.value.testCases.forEach((r,i)=>{t+=r.input+`
---OUTPUT---
`,t+=r.output,i<e.value.testCases.length-1&&(t+=`
---CASE---
`)}),t+=`
---SEPARATOR---
`,e.value.useSpecialJudge&&(t+=e.value.specialJudgeCode);const s=await G(t),o=await H(e.value.title,s);await W(`新题目提交: ${e.value.title}`,o.files["problem-description.md"].raw_url),_.success("题目提交成功"),F.push("/")}catch(l){console.error("Failed to submit problem:",l),_.error("提交失败")}finally{U.value=!1}},Q=async()=>{try{const l=await R.get("https://oj.xuqinyang.top/problems/list.txt"),t=l.data.split(`
`).filter(o=>o.trim()),s=(l.data.match(/\n/g)||[]).length+1;P.value=s-1}catch(l){console.error("Failed to load problems:",l)}};Z(()=>{Q(),e.value.submitType===1&&(d=L.create(k.value,{...C,language:"cpp",value:e.value.sourceCode}),d.onDidChangeModelContent(()=>{e.value.sourceCode=d.getValue()})),f=L.create(B.value,{...C,language:"markdown",value:e.value.readme}),f.onDidChangeModelContent(()=>{e.value.readme=f.getValue()}),window.addEventListener("resize",I)});const I=()=>{d&&d.layout(),f&&f.layout(),p&&p.layout()};return ee(()=>{d&&d.dispose(),f&&f.dispose(),p&&p.dispose(),window.removeEventListener("resize",I)}),(l,t)=>{const s=c("el-input"),o=c("el-form-item"),r=c("el-input-number"),i=c("el-option"),h=c("el-select"),v=c("el-radio"),O=c("el-radio-group"),T=c("el-switch"),w=c("el-icon"),m=c("el-button"),E=c("el-form");return y(),A("div",se,[a(E,{model:e.value,"label-width":"120px"},{default:u(()=>[a(o,{label:"题目标题",required:""},{default:u(()=>[a(s,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.title=n),placeholder:"请输入题目标题"},null,8,["modelValue"])]),_:1}),a(o,{label:"内存限制(MB)"},{default:u(()=>[a(r,{modelValue:e.value.memoryLimit,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.memoryLimit=n),min:1,max:1024,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(o,{label:"时间限制(ms)"},{default:u(()=>[a(r,{modelValue:e.value.timeLimit,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.timeLimit=n),min:100,max:1e4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(o,{label:"难度设置",required:""},{default:u(()=>[a(h,{modelValue:e.value.difficulty,"onUpdate:modelValue":t[3]||(t[3]=n=>e.value.difficulty=n),placeholder:"请选择题目难度"},{default:u(()=>[a(i,{label:"简单",value:"easy"}),a(i,{label:"中等",value:"medium"}),a(i,{label:"困难",value:"hard"})]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"提交方式"},{default:u(()=>[a(O,{modelValue:e.value.submitType,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.submitType=n)},{default:u(()=>[a(v,{label:1},{default:u(()=>t[7]||(t[7]=[S("提供源代码")])),_:1}),a(v,{label:2},{default:u(()=>t[8]||(t[8]=[S("提供输入输出")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.value.submitType===1?(y(),D(o,{key:0,label:"源代码",required:""},{default:u(()=>[b("div",{class:"editor-container",ref_key:"sourceCodeEditorContainer",ref:k},null,512)]),_:1})):x("",!0),a(o,{label:"题目描述",required:""},{default:u(()=>[b("div",{class:"editor-container",ref_key:"readmeEditorContainer",ref:B},null,512)]),_:1}),a(o,{label:"Special Judge"},{default:u(()=>[a(T,{modelValue:e.value.useSpecialJudge,"onUpdate:modelValue":t[5]||(t[5]=n=>e.value.useSpecialJudge=n)},null,8,["modelValue"])]),_:1}),e.value.useSpecialJudge?(y(),A(M,{key:1},[a(o,{label:"编程语言"},{default:u(()=>[a(h,{modelValue:e.value.language,"onUpdate:modelValue":t[6]||(t[6]=n=>e.value.language=n),placeholder:"选择编程语言",class:"language-select"},{default:u(()=>[a(i,{label:"C/C++",value:"cpp"}),a(i,{label:"Python",value:"python"}),a(i,{label:"Java",value:"java"})]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"Special Judge代码(C/C++)",required:""},{default:u(()=>[b("div",{class:"editor-container",ref_key:"specialJudgeEditorContainer",ref:N},null,512)]),_:1})],64)):x("",!0),a(o,{label:"测试样例"},{default:u(()=>[b("div",re,[(y(!0),A(M,null,te(e.value.testCases,(n,J)=>(y(),A("div",{key:J,class:"test-case"},[b("div",ie,[b("h4",null,"测试样例 #"+oe(J+1),1),a(m,{type:"danger",size:"small",circle:"",onClick:V=>$(J),class:"remove-button",disabled:e.value.testCases.length<=1},{default:u(()=>[a(w,null,{default:u(()=>[a(ne(ue))]),_:1})]),_:2},1032,["onClick","disabled"])]),a(s,{modelValue:n.input,"onUpdate:modelValue":V=>n.input=V,type:"textarea",rows:4,placeholder:"输入样例"},null,8,["modelValue","onUpdate:modelValue"]),e.value.submitType===2?(y(),D(s,{key:0,modelValue:n.output,"onUpdate:modelValue":V=>n.output=V,type:"textarea",rows:4,placeholder:"输出样例",class:"output-textarea"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]))),128))]),a(m,{type:"primary",onClick:q,class:"add-button"},{default:u(()=>t[9]||(t[9]=[S(" 添加测试样例 ")])),_:1})]),_:1}),a(o,null,{default:u(()=>[a(m,{type:"primary",onClick:Y,loading:U.value},{default:u(()=>t[10]||(t[10]=[S(" 提交 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},be=X(me,[["__scopeId","data-v-d3861c33"]]);export{be as default};
