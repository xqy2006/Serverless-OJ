import{_ as H,e as u,k as V,q as J,f as O,v as Q,c as F,a as l,w as r,r as i,o as K,b as f,d as S,t as h,p as N}from"./index-DTXGxQYd.js";import{a as X}from"./axios-DXsv3KKR.js";const Y={class:"status"},Z={class:"header"},ee={class:"filters"},te=["href"],le=["href"],ae={class:"pagination"},oe="xqy2006",se="Serverless-OJ",ne={__name:"Status",setup(re){const d=u(""),p=u(""),_=u(1),v=u(10),T=u(0),w=u([]),E=u([]),k=u(!1),b=u(!1),x=localStorage.getItem("github_token");let C=null;const m=JSON.parse(localStorage.getItem("problemIdCache"))||{},g={},U=async t=>{const e=L(t.title);return m[e]?m[e]:g[e]?(await g[e],m[e]):(g[e]=X.get(`/problems/${e}/problem.json`).then(n=>{const o=n.data.id;m[e]=o,localStorage.setItem("problemIdCache",JSON.stringify(m))}).catch(n=>{console.error("获取问题 ID 失败:",n),m[e]=null}).finally(()=>{delete g[e]}),await g[e],m[e])},L=t=>t.slice(0,-2),A=async()=>{try{k.value=!0;let t=`repo:${oe}/${se} is:issue "评测" in:title`,e;if(x?e=await fetch(`https://api.github.com/search/issues?q=${encodeURIComponent(t)}&per_page=100&sort=created&order=desc`,{headers:{Accept:"application/vnd.github.v3+json",Authorization:`token ${x}`}}):e=await fetch(`https://api.github.com/search/issues?q=${encodeURIComponent(t)}&per_page=100&sort=created&order=desc`,{headers:{Accept:"application/vnd.github.v3+json"}}),!e.ok)throw new Error("Network response was not ok");const n=await e.json();T.value=n.total_count;const o=await Promise.all(n.items.map(s=>U(s)));w.value=n.items.filter(s=>s.title.endsWith("评测")).map((s,y)=>{var c;return{id:String(s.number),problemId:o[y],html_url:s.html_url,problem:L(s.title),user:s.user.login,result:((c=s.labels.find(I=>["AC","WA","CE","RE","TLE","MLE","CHEATING"].includes(I.name)))==null?void 0:c.name)||"评测中",submitTime:new Date(s.created_at).toLocaleString()}})}catch(t){console.error("获取提交记录失败:",t)}finally{k.value=!1}},z=V(()=>{let t=[...w.value];if(p.value&&(t=t.filter(o=>o.result===p.value)),d.value){const o=d.value.toLowerCase();t=t.filter(s=>s.problem.toLowerCase().includes(o)||s.id.includes(o)||s.user.toLowerCase().includes(o))}if(b.value){const o=N().login;t=t.filter(s=>s.user===o)}const e=(_.value-1)*v.value,n=e+v.value;return E.value=t.slice(e,n),E.value}),q=V(()=>{let t=[...w.value];if(p.value&&(t=t.filter(e=>e.result===p.value)),d.value){const e=d.value.toLowerCase();t=t.filter(n=>n.problem.toLowerCase().includes(e)||n.id.includes(e)||n.user.toLowerCase().includes(e))}if(b.value){const e=N().login;t=t.filter(n=>n.user===e)}return t.length});J([d,p,b],()=>{_.value=1});const $=t=>{v.value=t,_.value=1},R=t=>{_.value=t},j=t=>({AC:"success",CE:"info",RE:"danger",TLE:"warning",MLE:"primary",CHEATING:"danger",WA:"danger",评测中:""})[t];return O(()=>{A(),C=setInterval(()=>{A()},1e4)}),Q(()=>{C&&clearInterval(C)}),(t,e)=>{const n=i("el-input"),o=i("el-option"),s=i("el-select"),y=i("el-checkbox"),c=i("el-table-column"),I=i("router-link"),D=i("el-tag"),M=i("el-table"),P=i("el-pagination"),W=i("el-card"),B=i("el-col"),G=i("el-row");return K(),F("div",Y,[l(G,{justify:"center"},{default:r(()=>[l(B,{xs:24,sm:22,md:20},{default:r(()=>[l(W,{class:"status-card"},{header:r(()=>[f("div",Z,[e[6]||(e[6]=f("h2",null,"评测状态",-1)),f("div",ee,[l(n,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),placeholder:"搜索题目/提交ID/用户","prefix-icon":"Search",class:"filter-item"},null,8,["modelValue"]),l(s,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),placeholder:"评测结果",class:"filter-item"},{default:r(()=>[l(o,{label:"全部",value:""}),l(o,{label:"通过",value:"AC"}),l(o,{label:"答案错误",value:"WA"}),l(o,{label:"编译错误",value:"CE"}),l(o,{label:"运行错误",value:"RE"}),l(o,{label:"超时",value:"TLE"}),l(o,{label:"内存超限",value:"MLE"}),l(o,{label:"作弊",value:"CHEATING"})]),_:1},8,["modelValue"]),l(y,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),class:"filter-item"},{default:r(()=>e[5]||(e[5]=[S(" 只看我的 ")])),_:1},8,["modelValue"])])])]),default:r(()=>[l(M,{data:z.value,style:{width:"100%"},class:"responsive-table"},{default:r(()=>[l(c,{prop:"id",label:"提交ID","min-width":"90"},{default:r(a=>[f("a",{href:a.row.html_url,target:"_blank"},h(a.row.id),9,te)]),_:1}),l(c,{prop:"problem",label:"题目","min-width":"120"},{default:r(a=>[l(I,{to:`/submit/${a.row.problemId}`},{default:r(()=>[S(h(a.row.problem),1)]),_:2},1032,["to"])]),_:1}),l(c,{prop:"result",label:"结果","min-width":"90"},{default:r(a=>[l(D,{type:j(a.row.result)},{default:r(()=>[S(h(a.row.result),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"user",label:"提交用户","min-width":"100"},{default:r(a=>[f("a",{href:`https://github.com/${a.row.user}`,target:"_blank"},h(a.row.user),9,le)]),_:1}),l(c,{prop:"submitTime",label:"提交时间","min-width":"160"})]),_:1},8,["data"]),f("div",ae,[l(P,{"current-page":_.value,"onUpdate:currentPage":e[3]||(e[3]=a=>_.value=a),"page-size":v.value,"onUpdate:pageSize":e[4]||(e[4]=a=>v.value=a),total:q.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:$,onCurrentChange:R,class:"responsive-pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})])}}},ce=H(ne,[["__scopeId","data-v-12f37680"]]);export{ce as default};
