import{_ as X,e as y,q as z,f as Z,l as ee,c as R,a,w as r,r as c,o as g,d as V,g as x,b,i as B,F as te,x as ae,u as oe,y as D,E as _,p as le,t as ne,z as se,A as re}from"./index-BCfW6nuy.js";import{e as A}from"./toggleHighContrast-S6Mnupxl.js";import{a as S}from"./axios-DXsv3KKR.js";const ie={class:"contribute-container"},ue={class:"test-cases"},de={class:"test-case-header"},ce="https://api.github.com",pe="xqy2006",me="Serverless-OJ",fe={__name:"Contribute",setup(ve){const M=oe(),L=y(null),P=y(null),k=y(!1),N=y(0),F=y([]),e=y({title:"",memoryLimit:256,timeLimit:1e3,difficulty:"easy",submitType:1,useSpecialJudge:!1,specialJudgeCode:`#include <stdio.h>
#include <stdlib.h>

int main(int argc, char* argv[]) {
    if (argc != 4) {
        fprintf(stderr, "Usage: spj <input_file> <output_file> <answer_file>\\n");
        return 2;  // 特判程序错误
    }

    FILE *fin = fopen(argv[1], "r");  // 输入文件
    FILE *fout = fopen(argv[2], "r"); // 选手输出
    FILE *fans = fopen(argv[3], "r"); // 标准答案

    if (!fin || !fout || !fans) {
        fprintf(stderr, "Failed to open files\\n");
        return 2;  // 特判程序错误
    }

    fclose(fin);
    fclose(fout);
    fclose(fans);

    return 0;  // 0: AC, 1: WA
}`,sourceCode:"",readme:"",testCases:[{input:"",output:""}]}),C={fontSize:14,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,language:"markdown",theme:"vs-light",wordWrap:"off",lineNumbers:"on",padding:{top:8,bottom:8}},I=y(null);let p=null,u=null,f=null;z(()=>e.value.useSpecialJudge,l=>{l&&D(()=>{p&&p.dispose(),p=A.create(I.value,{...C,language:"cpp",value:e.value.specialJudgeCode}),p.onDidChangeModelContent(()=>{e.value.specialJudgeCode=p.getValue()}),p.layout()})}),z(()=>e.value.submitType,l=>{l===1&&D(()=>{u&&u.dispose(),u=A.create(L.value,{...C,language:"cpp",value:e.value.sourceCode}),u.onDidChangeModelContent(()=>{e.value.sourceCode=u.getValue()}),u.layout()})});const $=()=>{e.value.testCases.push({input:"",output:""})},q=l=>{e.value.testCases.length>1&&e.value.testCases.splice(l,1)};async function G(l){const n=await(await fetch("/public_key.pem")).text(),o=await crypto.subtle.importKey("spki",j(n),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=await crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt"]),d=crypto.getRandomValues(new Uint8Array(16)),U=await crypto.subtle.exportKey("raw",i),v=await crypto.subtle.encrypt({name:"RSA-OAEP"},o,U),T=new TextEncoder().encode(l),h=await crypto.subtle.encrypt({name:"AES-CBC",iv:d},i,T),m=new Uint8Array(v.byteLength+d.byteLength+h.byteLength);m.set(new Uint8Array(v),0),m.set(d,v.byteLength),m.set(new Uint8Array(h),v.byteLength+d.byteLength);let w="";for(let s=0;s<m.length;s++)w+=String.fromCharCode(m[s]);return btoa(w)}function j(l){const t=l.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),n=atob(t),o=new Uint8Array(n.length);for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return o.buffer}async function H(l,t){const n=localStorage.getItem("github_token");if(!n)throw new Error("No GitHub token found");return(await S.post("https://api.github.com/gists",{description:l,public:!0,files:{"problem-description.md":{content:t}}},{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}})).data}async function W(l,t){const n=localStorage.getItem("github_token");if(!n)throw new Error("No GitHub token found");return(await S.post(`${ce}/repos/${pe}/${me}/issues`,{title:l,body:t},{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}})).data}const Y=async()=>{if(!e.value.title.trim()||!e.value.readme.trim()){_.error("题目标题和描述不能为空");return}if(e.value.testCases.some(l=>!l.input.trim())){_.error("所有测试样例的输入不能为空");return}if(e.value.submitType===1&&!e.value.sourceCode.trim()){_.error("源代码不能为空");return}if(e.value.submitType===2&&e.value.testCases.some(l=>!l.output.trim())){_.error("所有测试样例的输出不能为空");return}k.value=!0;try{const l={id:N.value+1,title:e.value.title,memoryLimit:e.value.memoryLimit,timeLimit:e.value.timeLimit,difficulty:e.value.difficulty,author:le().login,specialJudge:e.value.useSpecialJudge?1:0};let t=JSON.stringify(l)+`
---SEPARATOR---
`;t+=e.value.readme+`
---SEPARATOR---
`,e.value.submitType===1?(t+=`---SOURCE---
`,t+=e.value.sourceCode+`
---INPUTS---
`,e.value.testCases.forEach((i,d)=>{t+=i.input+`
`,d<e.value.testCases.length-1&&(t+=`---CASE---
`)})):e.value.testCases.forEach((i,d)=>{t+=i.input+`
---OUTPUT---
`,t+=i.output,d<e.value.testCases.length-1&&(t+=`
---CASE---
`)}),t+=`
---SEPARATOR---
`,e.value.useSpecialJudge&&(t+=e.value.specialJudgeCode);const n=await G(t),o=await H(e.value.title,n);await W(`新题目提交: ${e.value.title}`,o.files["problem-description.md"].raw_url),_.success("题目提交成功"),M.push("/")}catch(l){console.error("Failed to submit problem:",l),_.error("提交失败")}finally{k.value=!1}},Q=async()=>{try{const t=(await S.get("/problems/list.txt")).data.split(`
`).filter(o=>o.trim()),n=await Promise.all(t.map(async o=>(await S.get(`/problems/${o}/problem.json`)).data));F.value=n.sort((o,i)=>i.id-o.id),N.value=n.length}catch(l){console.error("Failed to load problems:",l)}};Z(()=>{Q(),e.value.submitType===1&&(u=A.create(L.value,{...C,language:"cpp",value:e.value.sourceCode}),u.onDidChangeModelContent(()=>{e.value.sourceCode=u.getValue()})),f=A.create(P.value,{...C,language:"markdown",value:e.value.readme}),f.onDidChangeModelContent(()=>{e.value.readme=f.getValue()}),window.addEventListener("resize",O)});const O=()=>{u&&u.layout(),f&&f.layout(),p&&p.layout()};return ee(()=>{u&&u.dispose(),f&&f.dispose(),p&&p.dispose(),window.removeEventListener("resize",O)}),(l,t)=>{const n=c("el-input"),o=c("el-form-item"),i=c("el-input-number"),d=c("el-option"),U=c("el-select"),v=c("el-radio"),K=c("el-radio-group"),T=c("el-switch"),h=c("el-icon"),m=c("el-button"),w=c("el-form");return g(),R("div",ie,[a(w,{model:e.value,"label-width":"120px"},{default:r(()=>[a(o,{label:"题目标题",required:""},{default:r(()=>[a(n,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.title=s),placeholder:"请输入题目标题"},null,8,["modelValue"])]),_:1}),a(o,{label:"内存限制(MB)"},{default:r(()=>[a(i,{modelValue:e.value.memoryLimit,"onUpdate:modelValue":t[1]||(t[1]=s=>e.value.memoryLimit=s),min:1,max:1024,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(o,{label:"时间限制(ms)"},{default:r(()=>[a(i,{modelValue:e.value.timeLimit,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.timeLimit=s),min:100,max:1e4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(o,{label:"难度设置",required:""},{default:r(()=>[a(U,{modelValue:e.value.difficulty,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.difficulty=s),placeholder:"请选择题目难度"},{default:r(()=>[a(d,{label:"简单",value:"easy"}),a(d,{label:"中等",value:"medium"}),a(d,{label:"困难",value:"hard"})]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"提交方式"},{default:r(()=>[a(K,{modelValue:e.value.submitType,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.submitType=s)},{default:r(()=>[a(v,{label:1},{default:r(()=>t[6]||(t[6]=[V("提供源代码")])),_:1}),a(v,{label:2},{default:r(()=>t[7]||(t[7]=[V("提供输入输出")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.value.submitType===1?(g(),x(o,{key:0,label:"源代码",required:""},{default:r(()=>[b("div",{class:"editor-container",ref_key:"sourceCodeEditorContainer",ref:L},null,512)]),_:1})):B("",!0),a(o,{label:"题目描述",required:""},{default:r(()=>[b("div",{class:"editor-container",ref_key:"readmeEditorContainer",ref:P},null,512)]),_:1}),a(o,{label:"Special Judge"},{default:r(()=>[a(T,{modelValue:e.value.useSpecialJudge,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.useSpecialJudge=s)},null,8,["modelValue"])]),_:1}),e.value.useSpecialJudge?(g(),x(o,{key:1,label:"Special Judge代码(C/C++)",required:""},{default:r(()=>[b("div",{class:"editor-container",ref_key:"specialJudgeEditorContainer",ref:I},null,512)]),_:1})):B("",!0),a(o,{label:"测试样例"},{default:r(()=>[b("div",ue,[(g(!0),R(te,null,ae(e.value.testCases,(s,J)=>(g(),R("div",{key:J,class:"test-case"},[b("div",de,[b("h4",null,"测试样例 #"+ne(J+1),1),a(m,{type:"danger",size:"small",circle:"",onClick:E=>q(J),class:"remove-button",disabled:e.value.testCases.length<=1},{default:r(()=>[a(h,null,{default:r(()=>[a(se(re))]),_:1})]),_:2},1032,["onClick","disabled"])]),a(n,{modelValue:s.input,"onUpdate:modelValue":E=>s.input=E,type:"textarea",rows:4,placeholder:"输入样例"},null,8,["modelValue","onUpdate:modelValue"]),e.value.submitType===2?(g(),x(n,{key:0,modelValue:s.output,"onUpdate:modelValue":E=>s.output=E,type:"textarea",rows:4,placeholder:"输出样例",class:"output-textarea"},null,8,["modelValue","onUpdate:modelValue"])):B("",!0)]))),128))]),a(m,{type:"primary",onClick:$,class:"add-button"},{default:r(()=>t[8]||(t[8]=[V(" 添加测试样例 ")])),_:1})]),_:1}),a(o,null,{default:r(()=>[a(m,{type:"primary",onClick:Y,loading:k.value},{default:r(()=>t[9]||(t[9]=[V(" 提交 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},_e=X(fe,[["__scopeId","data-v-febae9db"]]);export{_e as default};
