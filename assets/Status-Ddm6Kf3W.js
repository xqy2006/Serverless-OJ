import{_ as j,e as i,k,p as B,f as G,q as H,c as P,a,w as n,r,o as J,b as _,d as C,t as b,n as L}from"./index-D-JPBvNk.js";const O={class:"status"},Q={class:"header"},F={class:"filters"},K=["href"],X=["href"],Y={class:"pagination"},Z="xqy2006",ee="Serverless-OJ",te={__name:"Status",setup(le){const c=i(""),d=i(""),p=i(1),m=i(10),x=i(0),g=i([]),y=i([]),E=i(!1),v=i(!1);localStorage.getItem("github_token");let h=null;const I=t=>t.slice(0,-2),S=async()=>{try{E.value=!0;let t=`repo:${Z}/${ee} is:issue "评测" in:title`;const e=await fetch(`https://api.github.com/search/issues?q=${encodeURIComponent(t)}&per_page=100&sort=created&order=desc`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();x.value=s.total_count,g.value=s.items.filter(l=>l.title.endsWith("评测")).map(l=>{var u;return{id:String(l.number),problemId:l.number,html_url:l.html_url,problem:I(l.title),user:l.user.login,result:((u=l.labels.find(w=>["AC","WA","CE","RE","TLE","MLE","CHEATING"].includes(w.name)))==null?void 0:u.name)||"评测中",submitTime:new Date(l.created_at).toLocaleString()}})}catch(t){console.error("获取提交记录失败:",t)}finally{E.value=!1}},V=k(()=>{let t=[...g.value];if(d.value&&(t=t.filter(l=>l.result===d.value)),c.value){const l=c.value.toLowerCase();t=t.filter(u=>u.problem.toLowerCase().includes(l)||u.id.includes(l)||u.user.toLowerCase().includes(l))}if(v.value){const l=L().login;t=t.filter(u=>u.user===l)}const e=(p.value-1)*m.value,s=e+m.value;return y.value=t.slice(e,s),y.value}),T=k(()=>{let t=[...g.value];if(d.value&&(t=t.filter(e=>e.result===d.value)),c.value){const e=c.value.toLowerCase();t=t.filter(s=>s.problem.toLowerCase().includes(e)||s.id.includes(e)||s.user.toLowerCase().includes(e))}if(v.value){const e=L().login;t=t.filter(s=>s.user===e)}return t.length});B([c,d,v],()=>{p.value=1});const A=t=>{m.value=t,p.value=1},U=t=>{p.value=t},z=t=>({AC:"success",CE:"info",RE:"danger",TLE:"warning",MLE:"warning",CHEATING:"danger",WA:"danger",评测中:""})[t];return G(()=>{S(),h=setInterval(()=>{S()},1e4)}),H(()=>{h&&clearInterval(h)}),(t,e)=>{const s=r("el-input"),l=r("el-option"),u=r("el-select"),w=r("el-checkbox"),f=r("el-table-column"),N=r("router-link"),q=r("el-tag"),M=r("el-table"),R=r("el-pagination"),$=r("el-card"),D=r("el-col"),W=r("el-row");return J(),P("div",O,[a(W,{justify:"center"},{default:n(()=>[a(D,{xs:24,sm:22,md:20},{default:n(()=>[a($,{class:"status-card"},{header:n(()=>[_("div",Q,[e[6]||(e[6]=_("h2",null,"评测状态",-1)),_("div",F,[a(s,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),placeholder:"搜索题目/提交ID/用户","prefix-icon":"Search",class:"filter-item"},null,8,["modelValue"]),a(u,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),placeholder:"评测结果",class:"filter-item"},{default:n(()=>[a(l,{label:"全部",value:""}),a(l,{label:"通过",value:"AC"}),a(l,{label:"答案错误",value:"WA"}),a(l,{label:"编译错误",value:"CE"}),a(l,{label:"运行错误",value:"RE"}),a(l,{label:"超时",value:"TLE"}),a(l,{label:"内存超限",value:"MLE"}),a(l,{label:"作弊",value:"CHEATING"})]),_:1},8,["modelValue"]),a(w,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),class:"filter-item"},{default:n(()=>e[5]||(e[5]=[C(" 只看我的 ")])),_:1},8,["modelValue"])])])]),default:n(()=>[a(M,{data:V.value,style:{width:"100%"},class:"responsive-table"},{default:n(()=>[a(f,{prop:"id",label:"提交ID","min-width":"90"},{default:n(o=>[_("a",{href:o.row.html_url,target:"_blank"},b(o.row.id),9,K)]),_:1}),a(f,{prop:"problem",label:"题目","min-width":"120"},{default:n(o=>[a(N,{to:`/submit/${o.row.problem}`},{default:n(()=>[C(b(o.row.problem),1)]),_:2},1032,["to"])]),_:1}),a(f,{prop:"result",label:"结果","min-width":"90"},{default:n(o=>[a(q,{type:z(o.row.result)},{default:n(()=>[C(b(o.row.result),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"user",label:"提交用户","min-width":"100"},{default:n(o=>[_("a",{href:`https://github.com/${o.row.user}`,target:"_blank"},b(o.row.user),9,X)]),_:1}),a(f,{prop:"submitTime",label:"提交时间","min-width":"160"})]),_:1},8,["data"]),_("div",Y,[a(R,{"current-page":p.value,"onUpdate:currentPage":e[3]||(e[3]=o=>p.value=o),"page-size":m.value,"onUpdate:pageSize":e[4]||(e[4]=o=>m.value=o),total:T.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:A,onCurrentChange:U,class:"responsive-pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})])}}},oe=j(te,[["__scopeId","data-v-7a39d144"]]);export{oe as default};
