import{_ as V,e as y,f as K,E as b,c as k,a as n,w as r,j as M,r as l,o as L,b as m,t as f,i as N,d as I,u as P,l as T}from"./index-BPkb2VXz.js";import{m as O}from"./github-markdown-BOpQ1pHb.js";import{a as w}from"./axios-DXsv3KKR.js";const $={class:"submit"},D={class:"header"},H={key:0,class:"problem-info"},j=["innerHTML"],G="https://api.github.com",Y="xqy2006",q="Serverless-OJ",z={__name:"Submit",setup(F){const A=M(),S=P(),c=y(null),E=y(""),u=y({language:"cpp",code:""}),h=y(!1);K(async()=>{try{const e=await w.get(`/problems/${A.params.id}/problem.json`);c.value=e.data;const t=await w.get(`/problems/${A.params.id}/README.md`);E.value=O(t.data)}catch(e){console.error("Failed to load problem:",e),b.error("加载题目失败")}});async function R(e){const s=await(await fetch("/public_key.pem")).text(),i=await crypto.subtle.importKey("spki",U(s),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),o=await crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt"]),p=crypto.getRandomValues(new Uint8Array(16)),g=await crypto.subtle.exportKey("raw",o),d=await crypto.subtle.encrypt({name:"RSA-OAEP"},i,g),v=new TextEncoder().encode(e),_=await crypto.subtle.encrypt({name:"AES-CBC",iv:p},o,v),a=new Uint8Array(d.byteLength+p.byteLength+_.byteLength);return a.set(new Uint8Array(d),0),a.set(p,d.byteLength),a.set(new Uint8Array(_),d.byteLength+p.byteLength),btoa(String.fromCharCode(...a))}function U(e){const t=e.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),s=atob(t),i=new Uint8Array(s.length);for(let o=0;o<s.length;o++)i[o]=s.charCodeAt(o);return i.buffer}async function x(e,t){const s=localStorage.getItem("github_token");if(!s)throw new Error("No GitHub token found");return(await w.post(`${G}/repos/${Y}/${q}/issues`,{title:e,body:t},{headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json"}})).data}const B=async()=>{h.value=!0;try{if(u.value.code.trim()==""){b.error("代码不能为空"),h.value=!1;return}const e=await R(T().login+`
`+u.value.code);await x(c.value.title+"评测",e),b.success("提交成功"),setTimeout(()=>{S.push("/status")},3e3)}catch{b.error("提交失败")}};return(e,t)=>{const s=l("el-option"),i=l("el-select"),o=l("el-form-item"),p=l("el-input"),g=l("el-button"),d=l("el-form"),C=l("el-card"),v=l("el-col"),_=l("el-row");return L(),k("div",$,[n(_,{justify:"center"},{default:r(()=>[n(v,{span:20},{default:r(()=>[n(C,null,{header:r(()=>{var a;return[m("div",D,[m("h2",null,f((a=c.value)==null?void 0:a.title),1)])]}),default:r(()=>[c.value?(L(),k("div",H,[m("h5",null,"供题人："+f(c.value.author),1),m("h5",null,"内存限制："+f(c.value.memoryLimit)+" MB，时间限制："+f(c.value.timeLimit)+" ms",1),m("div",{class:"markdown-body",innerHTML:E.value},null,8,j)])):N("",!0),n(d,{model:u.value,class:"submit-form"},{default:r(()=>[n(o,{label:"编程语言"},{default:r(()=>[n(i,{modelValue:u.value.language,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value.language=a),placeholder:"选择编程语言"},{default:r(()=>[n(s,{label:"C++",value:"cpp"})]),_:1},8,["modelValue"])]),_:1}),n(o,{label:"代码"},{default:r(()=>[n(p,{modelValue:u.value.code,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.code=a),type:"textarea",rows:15,placeholder:"在此输入你的代码"},null,8,["modelValue"])]),_:1}),n(o,null,{default:r(()=>[n(g,{type:"primary",disabled:h.value,onClick:B},{default:r(()=>t[2]||(t[2]=[I(" 提交代码 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},X=V(z,[["__scopeId","data-v-655ec9f0"]]);export{X as default};
