import{_ as U,e as i,m as G,f as H,n as M,c as R,a as e,w as a,r,o as j,b as c,t as b,d as S}from"./index-BCFhymPB.js";const q={class:"status"},B={class:"header"},D={class:"filters"},P=["href"],W=["href"],J={class:"pagination"},O="xqy2006",Q="Serverless-OJ",F={__name:"Status",setup(K){const d=i(""),p=i(""),_=i(1),v=i(10),w=i(0),C=i([]),E=i(!1),y=localStorage.getItem("github_token");let f=null;const k=l=>l.slice(0,-2),m=async()=>{try{E.value=!0;let l=`repo:${O}/${Q} is:issue "评测" in:title`;d.value&&(l+=` ${d.value}`),p.value&&(l+=` label:${p.value}`);const o=await fetch(`https://api.github.com/search/issues?q=${encodeURIComponent(l)}&per_page=${v.value}&page=${_.value}&sort=created&order=desc`,{headers:{Accept:"application/vnd.github.v3+json",Authorization:`token ${y}`}});if(!o.ok)throw new Error("Network response was not ok");const g=await o.json();w.value=g.total_count;const s=g.items.filter(n=>n.title.endsWith("评测"));C.value=s.map(n=>{var u;return{id:String(n.number),problemId:n.number,html_url:n.html_url,problem:k(n.title),user:n.user.login,result:((u=n.labels.find(h=>["AC","WA","CE","TLE","MLE","CHEATING"].includes(h.name)))==null?void 0:u.name)||"评测中",submitTime:new Date(n.created_at).toLocaleString()}})}catch(l){console.error("获取提交记录失败:",l)}finally{E.value=!1}};G([d,p],()=>{_.value=1,m()});const I=l=>{v.value=l,m()},$=l=>{_.value=l,m()},T=l=>({AC:"success",CE:"info",RE:"danger",TLE:"warning",MLE:"warning",CHEATING:"danger",评测中:""})[l];return H(()=>{if(!y){console.error("GitHub token not found in localStorage");return}m(),f=setInterval(()=>{m()},1e4)}),M(()=>{f&&clearInterval(f)}),(l,o)=>{const g=r("el-input"),s=r("el-option"),n=r("el-select"),u=r("el-table-column"),h=r("router-link"),x=r("el-tag"),z=r("el-table"),A=r("el-pagination"),V=r("el-card"),N=r("el-col"),L=r("el-row");return j(),R("div",q,[e(L,{justify:"center"},{default:a(()=>[e(N,{span:20},{default:a(()=>[e(V,null,{header:a(()=>[c("div",B,[o[4]||(o[4]=c("h2",null,"评测状态",-1)),c("div",D,[e(g,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=t=>d.value=t),placeholder:"搜索题目名称","prefix-icon":"Search"},null,8,["modelValue"]),e(n,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=t=>p.value=t),placeholder:"评测结果"},{default:a(()=>[e(s,{label:"全部",value:""}),e(s,{label:"通过",value:"AC"}),e(s,{label:"编译错误",value:"CE"}),e(s,{label:"运行错误",value:"RE"}),e(s,{label:"超时",value:"TLE"}),e(s,{label:"内存超限",value:"MLE"}),e(s,{label:"作弊",value:"CHEATING"})]),_:1},8,["modelValue"])])])]),default:a(()=>[e(z,{data:C.value,style:{width:"100%"}},{default:a(()=>[e(u,{prop:"id",label:"提交ID",width:"100"},{default:a(t=>[c("a",{href:`${t.row.html_url}`,target:"_blank"},b(t.row.id),9,P)]),_:1}),e(u,{prop:"problem",label:"题目"},{default:a(t=>[e(h,{to:`/submit/${t.row.problem}`},{default:a(()=>[S(b(t.row.problem),1)]),_:2},1032,["to"])]),_:1}),e(u,{prop:"user",label:"提交用户",width:"120"},{default:a(t=>[c("a",{href:`https://github.com/${t.row.user}`,target:"_blank"},b(t.row.user),9,W)]),_:1}),e(u,{prop:"result",label:"结果",width:"120"},{default:a(t=>[e(x,{type:T(t.row.result)},{default:a(()=>[S(b(t.row.result),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"submitTime",label:"提交时间",width:"180"})]),_:1},8,["data"]),c("div",J,[e(A,{"current-page":_.value,"onUpdate:currentPage":o[2]||(o[2]=t=>_.value=t),"page-size":v.value,"onUpdate:pageSize":o[3]||(o[3]=t=>v.value=t),total:w.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:I,onCurrentChange:$},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})])}}},Y=U(F,[["__scopeId","data-v-04e414ad"]]);export{Y as default};
