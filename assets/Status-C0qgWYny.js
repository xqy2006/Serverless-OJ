import{_ as U,e as i,n as G,f as H,p as M,c as R,a as e,w as o,r as s,o as j,b as c,t as f,d as S}from"./index-T7vEc1ET.js";const q={class:"status"},B={class:"header"},D={class:"filters"},P=["href"],W=["href"],J={class:"pagination"},O="xqy2006",Q="Serverless-OJ",F={__name:"Status",setup(K){const d=i(""),p=i(""),_=i(1),v=i(10),w=i(0),C=i([]),E=i(!1),y=localStorage.getItem("github_token");let b=null;const k=l=>l.slice(0,-2),m=async()=>{try{E.value=!0;let l=`repo:${O}/${Q} is:issue "评测" in:title`;d.value&&(l+=` ${d.value}`),p.value&&(l+=` label:${p.value}`);const a=await fetch(`https://api.github.com/search/issues?q=${encodeURIComponent(l)}&per_page=${v.value}&page=${_.value}&sort=created&order=desc`,{headers:{Accept:"application/vnd.github.v3+json",Authorization:`token ${y}`}});if(!a.ok)throw new Error("Network response was not ok");const g=await a.json();w.value=g.total_count;const r=g.items.filter(n=>n.title.endsWith("评测"));C.value=r.map(n=>{var u;return{id:String(n.number),problemId:n.number,html_url:n.html_url,problem:k(n.title),user:n.user.login,result:((u=n.labels.find(h=>["AC","WA","CE","TLE","MLE","CHEATING"].includes(h.name)))==null?void 0:u.name)||"评测中",submitTime:new Date(n.created_at).toLocaleString()}})}catch(l){console.error("获取提交记录失败:",l)}finally{E.value=!1}};G([d,p],()=>{_.value=1,m()});const I=l=>{v.value=l,m()},x=l=>{_.value=l,m()},A=l=>({AC:"success",CE:"info",RE:"danger",TLE:"warning",MLE:"warning",CHEATING:"danger",WA:"danger",评测中:""})[l];return H(()=>{if(!y){console.error("GitHub token not found in localStorage");return}m(),b=setInterval(()=>{m()},1e4)}),M(()=>{b&&clearInterval(b)}),(l,a)=>{const g=s("el-input"),r=s("el-option"),n=s("el-select"),u=s("el-table-column"),h=s("router-link"),T=s("el-tag"),$=s("el-table"),z=s("el-pagination"),V=s("el-card"),N=s("el-col"),L=s("el-row");return j(),R("div",q,[e(L,{justify:"center"},{default:o(()=>[e(N,{xs:24,sm:22,md:20},{default:o(()=>[e(V,{class:"status-card"},{header:o(()=>[c("div",B,[a[4]||(a[4]=c("h2",null,"评测状态",-1)),c("div",D,[e(g,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),placeholder:"搜索题目名称","prefix-icon":"Search",class:"filter-item"},null,8,["modelValue"]),e(n,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=t=>p.value=t),placeholder:"评测结果",class:"filter-item"},{default:o(()=>[e(r,{label:"全部",value:""}),e(r,{label:"通过",value:"AC"}),e(r,{label:"编译错误",value:"CE"}),e(r,{label:"运行错误",value:"RE"}),e(r,{label:"超时",value:"TLE"}),e(r,{label:"内存超限",value:"MLE"}),e(r,{label:"作弊",value:"CHEATING"})]),_:1},8,["modelValue"])])])]),default:o(()=>[e($,{data:C.value,style:{width:"100%"},class:"responsive-table"},{default:o(()=>[e(u,{prop:"id",label:"提交ID","min-width":"90"},{default:o(t=>[c("a",{href:t.row.html_url,target:"_blank"},f(t.row.id),9,P)]),_:1}),e(u,{prop:"problem",label:"题目","min-width":"120"},{default:o(t=>[e(h,{to:`/submit/${t.row.problem}`},{default:o(()=>[S(f(t.row.problem),1)]),_:2},1032,["to"])]),_:1}),e(u,{prop:"result",label:"结果","min-width":"90"},{default:o(t=>[e(T,{type:A(t.row.result)},{default:o(()=>[S(f(t.row.result),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"user",label:"提交用户","min-width":"100"},{default:o(t=>[c("a",{href:`https://github.com/${t.row.user}`,target:"_blank"},f(t.row.user),9,W)]),_:1}),e(u,{prop:"submitTime",label:"提交时间","min-width":"160"})]),_:1},8,["data"]),c("div",J,[e(z,{"current-page":_.value,"onUpdate:currentPage":a[2]||(a[2]=t=>_.value=t),"page-size":v.value,"onUpdate:pageSize":a[3]||(a[3]=t=>v.value=t),total:w.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:I,onCurrentChange:x,class:"responsive-pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})])}}},Y=U(F,[["__scopeId","data-v-342553ae"]]);export{Y as default};
