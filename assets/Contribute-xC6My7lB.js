import{_ as Z,e as g,B as D,f as ee,l as te,c as A,a,w as s,r as p,o as y,d as S,g as K,b,i as x,F as M,C as ae,u as le,D as z,E as _,p as oe,t as ne,y as se,G as ue}from"./index-BZesiFmf.js";import{e as L}from"./toggleHighContrast-DCwP5-yA.js";import{a as k}from"./axios-DXsv3KKR.js";const re={class:"contribute-container"},ie={class:"test-cases"},de={class:"test-case-header"},pe="https://api.github.com",ce="xqy2006",me="Serverless-OJ",fe={__name:"Contribute",setup(ve){const F=le(),U=g(null),B=g(null),T=g(!1),P=g(0),$=g([]),e=g({title:"",memoryLimit:256,timeLimit:1e3,difficulty:"easy",submitType:1,useSpecialJudge:!1,specialJudgeCode:`#include <stdio.h>
#include <stdlib.h>

int main(int argc, char* argv[]) {
    if (argc != 4) {
        fprintf(stderr, "Usage: spj <input_file> <output_file> <answer_file>\\n");
        return 2;  // 特判程序错误
    }

    FILE *fin = fopen(argv[1], "r");  // 输入文件
    FILE *fout = fopen(argv[2], "r"); // 选手输出
    FILE *fans = fopen(argv[3], "r"); // 标准答案

    if (!fin || !fout || !fans) {
        fprintf(stderr, "Failed to open files\\n");
        return 2;  // 特判程序错误
    }

    fclose(fin);
    fclose(fout);
    fclose(fans);

    return 0;  // 0: AC, 1: WA
}`,language:"cpp",sourceCode:"",readme:"",testCases:[{input:"",output:""}]}),C={fontSize:14,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,language:"markdown",theme:"vs-light",wordWrap:"off",lineNumbers:"on",padding:{top:8,bottom:8}},N=g(null);let c=null,d=null,f=null;D(()=>e.value.useSpecialJudge,o=>{o&&z(()=>{c&&c.dispose(),c=L.create(N.value,{...C,language:"cpp",value:e.value.specialJudgeCode}),c.onDidChangeModelContent(()=>{e.value.specialJudgeCode=c.getValue()}),c.layout()})}),D(()=>e.value.submitType,o=>{o===1&&z(()=>{d&&d.dispose(),d=L.create(U.value,{...C,language:"cpp",value:e.value.sourceCode}),d.onDidChangeModelContent(()=>{e.value.sourceCode=d.getValue()}),d.layout()})});const q=()=>{e.value.testCases.push({input:"",output:""})},G=o=>{e.value.testCases.length>1&&e.value.testCases.splice(o,1)};async function j(o){const u=await(await fetch("/public_key.pem")).text(),l=await crypto.subtle.importKey("spki",H(u),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=await crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt"]),i=crypto.getRandomValues(new Uint8Array(16)),h=await crypto.subtle.exportKey("raw",r),v=await crypto.subtle.encrypt({name:"RSA-OAEP"},l,h),J=new TextEncoder().encode(o),w=await crypto.subtle.encrypt({name:"AES-CBC",iv:i},r,J),m=new Uint8Array(v.byteLength+i.byteLength+w.byteLength);m.set(new Uint8Array(v),0),m.set(i,v.byteLength),m.set(new Uint8Array(w),v.byteLength+i.byteLength);let E="";for(let n=0;n<m.length;n++)E+=String.fromCharCode(m[n]);return btoa(E)}function H(o){const t=o.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),u=atob(t),l=new Uint8Array(u.length);for(let r=0;r<u.length;r++)l[r]=u.charCodeAt(r);return l.buffer}async function W(o,t){const u=localStorage.getItem("github_token");if(!u)throw new Error("No GitHub token found");return(await k.post("https://api.github.com/gists",{description:o,public:!0,files:{"problem-description.md":{content:t}}},{headers:{Authorization:`token ${u}`,Accept:"application/vnd.github.v3+json"}})).data}async function Y(o,t){const u=localStorage.getItem("github_token");if(!u)throw new Error("No GitHub token found");return(await k.post(`${pe}/repos/${ce}/${me}/issues`,{title:o,body:t},{headers:{Authorization:`token ${u}`,Accept:"application/vnd.github.v3+json"}})).data}const Q=async()=>{if(!e.value.title.trim()||!e.value.readme.trim()){_.error("题目标题和描述不能为空");return}if(e.value.testCases.some(o=>!o.input.trim())){_.error("所有测试样例的输入不能为空");return}if(e.value.submitType===1&&!e.value.sourceCode.trim()){_.error("源代码不能为空");return}if(e.value.submitType===2&&e.value.testCases.some(o=>!o.output.trim())){_.error("所有测试样例的输出不能为空");return}T.value=!0;try{const o={id:P.value+1,title:e.value.title,memoryLimit:e.value.memoryLimit,timeLimit:e.value.timeLimit,difficulty:e.value.difficulty,author:oe().login,specialJudge:{enabled:e.value.useSpecialJudge,language:"cpp"}};let t=JSON.stringify(o)+`
---SEPARATOR---
`;t+=e.value.readme+`
---SEPARATOR---
`,e.value.submitType===1?(t+=`---SOURCE---
`,t+=e.value.sourceCode+`
---INPUTS---
`,e.value.testCases.forEach((r,i)=>{t+=r.input+`
`,i<e.value.testCases.length-1&&(t+=`---CASE---
`)})):e.value.testCases.forEach((r,i)=>{t+=r.input+`
---OUTPUT---
`,t+=r.output,i<e.value.testCases.length-1&&(t+=`
---CASE---
`)}),t+=`
---SEPARATOR---
`,e.value.useSpecialJudge&&(t+=e.value.specialJudgeCode);const u=await j(t),l=await W(e.value.title,u);await Y(`新题目提交: ${e.value.title}`,l.files["problem-description.md"].raw_url),_.success("题目提交成功"),F.push("/")}catch(o){console.error("Failed to submit problem:",o),_.error("提交失败")}finally{T.value=!1}},X=async()=>{try{const t=(await k.get("/problems/list.txt")).data.split(`
`).filter(l=>l.trim()),u=await Promise.all(t.map(async l=>(await k.get(`/problems/${l}/problem.json`)).data));$.value=u.sort((l,r)=>r.id-l.id),P.value=u.length}catch(o){console.error("Failed to load problems:",o)}};ee(()=>{X(),e.value.submitType===1&&(d=L.create(U.value,{...C,language:"cpp",value:e.value.sourceCode}),d.onDidChangeModelContent(()=>{e.value.sourceCode=d.getValue()})),f=L.create(B.value,{...C,language:"markdown",value:e.value.readme}),f.onDidChangeModelContent(()=>{e.value.readme=f.getValue()}),window.addEventListener("resize",I)});const I=()=>{d&&d.layout(),f&&f.layout(),c&&c.layout()};return te(()=>{d&&d.dispose(),f&&f.dispose(),c&&c.dispose(),window.removeEventListener("resize",I)}),(o,t)=>{const u=p("el-input"),l=p("el-form-item"),r=p("el-input-number"),i=p("el-option"),h=p("el-select"),v=p("el-radio"),O=p("el-radio-group"),J=p("el-switch"),w=p("el-icon"),m=p("el-button"),E=p("el-form");return y(),A("div",re,[a(E,{model:e.value,"label-width":"120px"},{default:s(()=>[a(l,{label:"题目标题",required:""},{default:s(()=>[a(u,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.title=n),placeholder:"请输入题目标题"},null,8,["modelValue"])]),_:1}),a(l,{label:"内存限制(MB)"},{default:s(()=>[a(r,{modelValue:e.value.memoryLimit,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.memoryLimit=n),min:1,max:1024,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(l,{label:"时间限制(ms)"},{default:s(()=>[a(r,{modelValue:e.value.timeLimit,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.timeLimit=n),min:100,max:1e4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(l,{label:"难度设置",required:""},{default:s(()=>[a(h,{modelValue:e.value.difficulty,"onUpdate:modelValue":t[3]||(t[3]=n=>e.value.difficulty=n),placeholder:"请选择题目难度"},{default:s(()=>[a(i,{label:"简单",value:"easy"}),a(i,{label:"中等",value:"medium"}),a(i,{label:"困难",value:"hard"})]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"提交方式"},{default:s(()=>[a(O,{modelValue:e.value.submitType,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.submitType=n)},{default:s(()=>[a(v,{label:1},{default:s(()=>t[7]||(t[7]=[S("提供源代码")])),_:1}),a(v,{label:2},{default:s(()=>t[8]||(t[8]=[S("提供输入输出")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.value.submitType===1?(y(),K(l,{key:0,label:"源代码",required:""},{default:s(()=>[b("div",{class:"editor-container",ref_key:"sourceCodeEditorContainer",ref:U},null,512)]),_:1})):x("",!0),a(l,{label:"题目描述",required:""},{default:s(()=>[b("div",{class:"editor-container",ref_key:"readmeEditorContainer",ref:B},null,512)]),_:1}),a(l,{label:"Special Judge"},{default:s(()=>[a(J,{modelValue:e.value.useSpecialJudge,"onUpdate:modelValue":t[5]||(t[5]=n=>e.value.useSpecialJudge=n)},null,8,["modelValue"])]),_:1}),e.value.useSpecialJudge?(y(),A(M,{key:1},[a(l,{label:"编程语言"},{default:s(()=>[a(h,{modelValue:e.value.language,"onUpdate:modelValue":t[6]||(t[6]=n=>e.value.language=n),placeholder:"选择编程语言",class:"language-select"},{default:s(()=>[a(i,{label:"C/C++",value:"cpp"}),a(i,{label:"Python",value:"python"}),a(i,{label:"Java",value:"java"})]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"Special Judge代码(C/C++)",required:""},{default:s(()=>[b("div",{class:"editor-container",ref_key:"specialJudgeEditorContainer",ref:N},null,512)]),_:1})],64)):x("",!0),a(l,{label:"测试样例"},{default:s(()=>[b("div",ie,[(y(!0),A(M,null,ae(e.value.testCases,(n,R)=>(y(),A("div",{key:R,class:"test-case"},[b("div",de,[b("h4",null,"测试样例 #"+ne(R+1),1),a(m,{type:"danger",size:"small",circle:"",onClick:V=>G(R),class:"remove-button",disabled:e.value.testCases.length<=1},{default:s(()=>[a(w,null,{default:s(()=>[a(se(ue))]),_:1})]),_:2},1032,["onClick","disabled"])]),a(u,{modelValue:n.input,"onUpdate:modelValue":V=>n.input=V,type:"textarea",rows:4,placeholder:"输入样例"},null,8,["modelValue","onUpdate:modelValue"]),e.value.submitType===2?(y(),K(u,{key:0,modelValue:n.output,"onUpdate:modelValue":V=>n.output=V,type:"textarea",rows:4,placeholder:"输出样例",class:"output-textarea"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]))),128))]),a(m,{type:"primary",onClick:q,class:"add-button"},{default:s(()=>t[9]||(t[9]=[S(" 添加测试样例 ")])),_:1})]),_:1}),a(l,null,{default:s(()=>[a(m,{type:"primary",onClick:Q,loading:T.value},{default:s(()=>t[10]||(t[10]=[S(" 提交 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},_e=Z(fe,[["__scopeId","data-v-b04611d0"]]);export{_e as default};
